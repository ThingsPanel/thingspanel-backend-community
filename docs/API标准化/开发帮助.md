# å¼€å‘å¸®åŠ©

## é¡¹ç›®ç»“æ„

```text
project-root/
â”œâ”€â”€ main.go                         # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ middleware/                     # ä¸­é—´ä»¶
â”‚   â””â”€â”€ response/                  # å“åº”å¤„ç†
â”‚       â”œâ”€â”€ middleware.go          # å“åº”ä¸­é—´ä»¶
â”‚       â””â”€â”€ response.go            # å“åº”ç»“æ„ä½“å®šä¹‰
â”œâ”€â”€ pkg/                           # å…¬å…±åŒ…
â”‚   â”œâ”€â”€ errcode/                  # é”™è¯¯ç å¤„ç†
â”‚   â”‚   â”œâ”€â”€ code.go              # é”™è¯¯ç å¸¸é‡
â”‚   â”‚   â”œâ”€â”€ error.go             # é”™è¯¯å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ manager.go           # é”™è¯¯ç ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ validator.go         # é”™è¯¯ç éªŒè¯
â”‚   â””â”€â”€ metrics/                  # æ€§èƒ½ç›‘æ§
â”‚       â””â”€â”€ metrics.go            # ç›‘æ§æŒ‡æ ‡å®šä¹‰
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.yaml              # ä¸»é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ messages.yaml            # é”™è¯¯æ¶ˆæ¯é…ç½®
â”œâ”€â”€ go.mod                        # Goæ¨¡å—æ–‡ä»¶
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ä½¿ç”¨ç¤ºä¾‹

ğŸ’¡äºå¯¹äºæ ¸å¿ƒé”™è¯¯ç (å¦‚ç³»ç»Ÿé”™è¯¯ã€é€šç”¨ä¸šåŠ¡é”™è¯¯)ï¼Œä½¿ç”¨å¸¸é‡pkg/errcode/code.go
å¯¹äºå…·ä½“ä¸šåŠ¡é”™è¯¯ç ï¼Œç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²å½¢å¼
é‡ç‚¹æ˜¯ä¿è¯ messages.yaml çš„ç»´æŠ¤å’Œå®Œæ•´æ€§

```go
// internal/service/user.go
package service

import (
   "context"
   "project/pkg/errcode"
)

type UserService struct {
   repo UserRepository
}

func NewUserService(repo UserRepository) *UserService {
   return &UserService{repo: repo}
}

func (s *UserService) GetUser(ctx context.Context, id int64) (*User, error) {
   // ä½¿ç”¨ Newf ç¤ºä¾‹ - å‚æ•°é”™è¯¯
   if id <= 0 {
       return nil, errcode.Newf(errcode.CodeParamError, id)
   }

   user, err := s.repo.GetUser(ctx, id)
   if err != nil {
       if isNotFoundError(err) {
           // ä½¿ç”¨ WithVars ç¤ºä¾‹ - ç”¨æˆ·ä¸å­˜åœ¨
           return nil, errcode.WithVars(errcode.CodeNotFound, map[string]interface{}{
               "id": id,
               "error": "ç”¨æˆ·ä¸å­˜åœ¨",
           })
       }
       // ä½¿ç”¨ WithData ç¤ºä¾‹ - æ•°æ®åº“é”™è¯¯
       return nil, errcode.WithData(errcode.CodeDBError, map[string]interface{}{
           "sql_error": err.Error(),
           "user_id": id,
       })
   }

   return user, nil
}

// internal/api/handler/user.go
package handler

import (
   "github.com/gin-gonic/gin"
   "project/internal/service"
   "project/pkg/errcode"
)

type UserHandler struct {
   userSvc *service.UserService
}

func NewUserHandler(svc *service.UserService) *UserHandler {
   return &UserHandler{userSvc: svc}
}

func (h *UserHandler) GetUser(c *gin.Context) {
   id := c.GetInt64Param("id")
   
   // å‚æ•°æ ¡éªŒ
   if id <= 0 {
       // ä½¿ç”¨ NewWithMessage ç¤ºä¾‹
       c.Error(errcode.NewWithMessage(200015, "è¯·è¾“å…¥æœ‰æ•ˆçš„ç”¨æˆ·ID"))
       return
   }

   user, err := h.userSvc.GetUser(c, id)
   if err != nil {
       c.Error(err)
       return
   }

   c.Set("data", user)
}
```
